<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta content="Please, never say 'widgets' in my presence again." name='description'>
<meta content='IE=edge;chrome=1' http-equiv='X-UA-Compatible'>
<meta content='width=device-width, initial-scale=1' name='viewport'>
<meta content='True' name='HandheldFriendly'>
<meta content='320' name='MobileOptimized'>
<link href='/favicon.png' rel='icon'>
<title>Awkward and Proud - Joshua Davey</title>
<link href="/stylesheets/screen.css" rel="stylesheet" type="text/css" />
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml" />
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js'></script>
<script src='/javascripts/main.js'></script>
</head>
<body>
<div id='content'>
<header>
<h1><a href="/">Awkward and Proud</a></h1>
</header>
<div id='description'>
<ul class='meta'>
<li>
<a href="/about">About</a>
/
<a href="/atom.xml">RSS</a>
</li>
</ul>
</div>
<div id='main'><div class='post'>
<div class='post-body'>
<h2>Rails migrations - Checking the existence of a table</h2>
<p>Recently, I had to drop a table because I no longer needed the model at all. However, working on a distributed team, there were other folks with varying levels of &ldquo;migration&rdquo; status for their databases. A first migration to drop the table would be simply the following: </p>

<script src="http://gist.github.com/530421.js?file=original_migration.rb"></script> 

<p>However, I also wanted to get rid of the original migration file that created the file to begin with, since it was no longer meaningful. As it turns out, checking the existence of a table isn&rsquo;t complicated at all: </p>

<script src="http://gist.github.com/530421.js?file=better_migration.rb"></script> 

<p>Now, folks who never had that table to begin with won&rsquo;t get an error when running <code>rake db:migrate</code>, and those who did will simply drop it. This works because <code>connection</code> is actually delegated to <code>ActiveRecord::Base.connection</code>.</p>

<p>As a disclaimer, I&rsquo;ve only used this technique in Rails 2.3, so I can&rsquo;t vouch for it working in other versions.</p>

</div>
</div>
</div>
</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-330362-1"]);
  _gaq.push(["_trackPageview"]);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
